<!DOCTYPE html>
<html dir="{{direction}}" lang="{{lang}}">
<head>
    <title>{{title}}</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <base href="{{base}}" />
    {% if show_meta_robots %}
        <meta name="robots" content="noindex, follow" />
    {% endif %}
    {% if description %}
        <meta name="description" content="{{description}}" />
    {% endif %}
    {% if keywords %}
        <meta name="keywords" content="{{keywords}}" />
    {% endif %}
    <meta property="og:title" content="{{title}}" />
    <meta property="og:type" content="website" />
    {% if og_url%}
        <meta property="og:url" content="{{og_url}}" />
    {% endif %}
    {% if og_image %}
        <meta property="og:image" content="{{og_image}}" />
    {% else %}
        <meta property="og:image" content="{{logo}}" />
    {% endif %}
    <meta property="og:site_name" content="{{name}}" />
    {% for link in links %}
        <link href="{{link.href}}" rel="{{link.rel}}" />
    {% endfor %}
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
    {% for style in styles %}
        <link href="{{style.href}}" type="text/css" rel="{{style.rel}}" media="{{style.media}}" />
    {% endfor %}
    {% if custom_style %}
        <link href="catalog/view/theme/unishop2/stylesheet/{{custom_style}}" rel="stylesheet" media="screen" />
    {% endif %}
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" href="/catalog/view/theme/kate/src/styles/icomoon.css">
    <link rel="stylesheet" href="/catalog/view/theme/kate/css/main.css">
    {% if user_css %}
        <style>{{user_css}}</style>
    {% endif %}
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="/catalog/view/theme/kate/src/js/script.js"></script>
    <script src="/catalog/view/theme/kate/src/js/slider.js"></script>
    <script>if(!localStorage.getItem('display')) localStorage.setItem('display', '{{default_view}}');</script>
    <script src="catalog/view/theme/unishop2/js/jquery.maskedinput.min.js"></script>
    {% if user_js %}
        <script>{{user_js}}</script>
    {% endif %}
    {% for script in scripts %}
        <script src="{{script}}"></script>
    {% endfor %}
</head>
<body">
<header class="header">
    <div class="container">
        <div class="row row_flex">
            <div class="header__column address" style="line-height: 1.5;">
                {{ address2 }}
            </div>
            <div class="header__column header__logo">
                <div class="logo">
                    {{ name }}
                </div>
            </div>
            <div class="header__column header__contact">
                <ul class="contact">
                    <li class="contact__item contact__phone">
                        <a href="tel:{{ telephone }}">{{ telephone }}</a>
                    </li>
                    <li class="contact__item contact__time">{{ open }}</li>
                    <li class="contact__item contact__feedback"><a href="#" class="link link_underline js-feedback-toggle">Хотите мы вам перезвоним?</a></li>
                </ul>
            </div>
            {% if menu_mobile %}
                <div class="mobile-menu">
                    <div class="hamburger">
                        <div id="nav-icon3">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                    <ul class="mobile-menu__list js-mobile-menu">
                        {% for item in menu_mobile %}
                            <li class="mobile-menu__item">
                                <a href="{{ item.link }}">{{ item.title }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
        {{ menu }}
    </div>
    <div class="modal js-feedback-modal">
        <div class="modal__wrapper">
            <div class="modal__content">
                <div class="modal__header">
                    <h2 class="modal__title">Оставьте заявку</h2>
                    <p class="modal__subtitle">и мы Вам перезвоним</p>
                    <a href="#" class="modal__close js-close-modal"></a>
                </div>
                <form class="form" id="js-form-request-call-me">
                   <div class="form__wrapper">
                       <div class="form__row">
                           <div class="input">
                               <input type="text" name="firstname" class="input__field input__field_bordered" placeholder="Имя *">
                           </div>
                           <div class="input">
                               <input type="text" name="lastname" class="input__field input__field_bordered" placeholder="Фамилия *">
                           </div>
                       </div>
                       <div class="form__row">
                           <div class="input">
                               <input type="tel" name="telephone" class="input__field input__field_bordered" placeholder="Телефон *">
                           </div>
                       </div>
                       <div class="form_row">
                           <div class="button-group">
                               <button class="button button_default button_wide" id="js_send_message_call_me">Оставить заявку</button>
                           </div>
                       </div>
                   </div>
                </form>
            </div>
        </div>
    </div>
</header>
<div id="main-content" role="main">

<script type="text/javascript">
    $('#js_send_message_call_me').click(function(event) {
        event.preventDefault();
        if (validateFormRegister())  {
            $.ajax({
                url: 'index.php?route=account/callme/validateForm',
                type: 'POST',
                dataType: 'json',
                data: $('#js-form-request-call-me').serialize(),
                success: function (data) {
                    if (!data['status']) {
                        if (data['error']) {
                            $.each(data['error'], function(index, value){
                               $('#js-form-request-call-me [name=' +  index + ']').after("<p class='input__error'>" + value + "</p>");
                            });
                        }
                    } else {
                        sendMessage();
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
        }
    });

    function sendMessage()
    {
        $.ajax({
            url: 'index.php?route=account/callme/sendMessage',
            type: 'POST',
            dataType: 'json',
            data: $('#js-form-request-call-me').serialize(),
            success: function (data) {
                if (!data['status']) {
                    if (data['error']) {
                        $.each(data['error'], function(index, value){
                            $('#js-form-request-call-me [name=' +  index + ']').after("<p class='input__error'>" + value + "</p>");
                        });
                    }
                } else if (data['status']) {

                    $('.js-feedback-modal').removeClass('open');

                    html = '<div class="modal open">';
                    html += '   <div class="modal__wrapper">';
                    html += '       <div class="modal__content">';
                    html += '           <div class="modal__header">';
                    html += '               <h2 class="modal__title modal__title_medium">Спасибо за подписку!</h2>';
                    html += '               <p class="modal__subtitle">Ваша заявка будет рассмотрена в ближайшее время</p>';
                    html += '               <a href="#" class="modal__close js-close-modal"></a>';
                    html += '           </div>';
                    html += '       </div>';
                    html += '   </div>';
                    html += '</div>';

                    $('body').append(html);

                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    }

    function validateFormRegister()
    {
        $('.input__error').remove();
        let flag = true;

        // Имя
        let name = $('#js-form-request-call-me [name="firstname"]').val();
        if (!name) {
            $('#js-form-request-call-me [name="firstname"]').after('<div class="input__error">Поле Имя должно быть заполнено</div>');
            flag = false;
        }

        // Фамилия
        let lastName = $('#js-form-request-call-me [name="lastname"]').val();
        if (!lastName) {
            $('#js-form-request-call-me [name="lastname"]').after('<div class="input__error">Поле Фамилия должно быть заполнено</div>');
            flag = false;
        }

        // Телефон
        let telephone = $('#js-form-request-call-me [name="telephone"]').val();
        if (!telephone) {
            $('#js-form-request-call-me [name="telephone"]').after('<div class="input__error">Поле Телефон должно быть заполнено</div>');
            flag = false;
        }

        return flag;
    }
</script>